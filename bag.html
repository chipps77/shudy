<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

<link href="https://cdn.jsdelivr.net/gh/Unifoundry/Unifont@14.0.01/font-builds/unifont.min.css" rel="stylesheet"/>
<meta charset="utf-8"/>
<title>背包</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="style.css" rel="stylesheet"/>
<style>
    body {
      
      font-family: monospace;
      font-size: 14px;
      letter-spacing: 0.5px;
   }

    .card h1 {
      text-align: center;
      font-family: 'VT323', monospace;
      font-size: 37px;
      margin-top: 20;
      margin-bottom: 10px;
   }

    .item-button {
      display: inline-block;
      background-color: #fff;
      border: 2px solid #000;
      border-radius: 12px;
      padding: 10px 16px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.2s, transform 0.1s;
    }

    .item-button:hover {
      background-color: #f0f0f0;
      transform: scale(1.02);
    }

    .card-wrapper {
      display: flex;
      justify-content: center;
      gap: 40px;
    }

    .card {
      background: #fff;
      border: 4px solid #000;
      border-radius: 24px;
      box-shadow: 8px 8px 0 #000;
      padding: 32px;
      width: 280px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    #idolStatic {
      width: 128px;
      height: 128px;
      image-rendering: pixelated;
      align-self: center;
    }

    

    .pixel-bar {
     display: flex;
     gap: 2px;
     justify-content: center;
     margin: 6px auto 0 auto; 
     width: fit-content;
   }


 .idolTextWrapper {
  display: flex;
  justify-content: center;
  margin-top: 16px;  /* ✅ 增加與圖片的距離 */
  margin-bottom: 6px;
}

#idolText {
  font-family: 'VT323', monospace;
  font-size: 12px;
  color: #000;
  background-color: #fff;
  padding: 10px 16px;
  border: 4px solid #000;
  border-radius: 8px;
  box-shadow: 4px 4px 0 #000;
  text-align: center;
  line-height: 1.3;
  transition: opacity 0.3s ease;

  min-height: 48px;
  max-height: 48px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

#idolText:empty {
  display: none;
}


    button {
      font-size: 14px;
      font-family: sans-serif;
      padding: 10px 20px;
      cursor: pointer;
    }
    .idol-info {
      text-align: center;
    }

  </style>
</head>
<body>
<div class="main-wrapper">
<div class="card-wrapper">

<!-- 左邊卡片：偶像區 -->
<div class="card" style="position: relative;">
  <div class="card-inner" style="margin-top: 24px;">
    <!-- 偶像圖片 -->
    <img id="idolStatic" src="sit.png"
         style="width: 120px; height: 120px; image-rendering: pixelated; display: block; margin: 0 auto 20px;" />
	<div id="idolNameText"
     style="text-align: center;
            font-family: 'VT323', monospace;
            font-size: 37px;
            margin-bottom: 12px;
            padding-bottom: 4px;
            border-bottom: 2px solid #000;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;">
</div>


    <!-- 等級與經驗條 -->
    <div class="idol-info">
      等級：<span id="idolLevel">1</span><br/>
      經驗值：<span id="idolExp">0</span> / <span id="expToNext">100</span>
      <div class="pixel-bar" id="expBarContainer"></div>
    </div>

    <!-- 舒華說話 -->
    <div class="idolTextWrapper">
      <div id="idolText"></div>
    </div>
  </div>

  <!-- 狗狗圖片與名字，固定在卡片底部 -->
  <div id="dogDisplayContainer"
       style="position: absolute; bottom: 52px; left: 0; width: 100%;
              display: flex; justify-content: center; gap: 8px;">
  </div>
</div>



<!-- 右邊卡片：背包區 -->
<div class="card">
<h1>backpack</h1>
<!-- 分頁標籤 -->
<div class="tabs">
<div class="tab active" data-tab="food" onclick="switchTab('food')">🍽️ 食物</div>
<div class="tab" data-tab="decor" onclick="switchTab('decor')">🖼️ 裝飾</div>
<div class="tab" data-tab="style" onclick="switchTab('style')">👗 造型</div></div>
<!-- 固定高度的內容容器 -->
<div class="tab-content-container">
<div class="tab-panel active" id="tab_food">
<div class="item-button" onclick="feedIdol('cake')">🍰 蛋糕：<span id="cake">0</span></div>
<div class="item-button" onclick="feedIdol('vege')">🥬 蔬菜：<span id="vege">0</span></div>
<div class="item-button" onclick="feedIdol('kimchi_rice')">🍛 泡菜炒飯：<span id="kimchi_rice">0</span></div>
<div class="item-button" onclick="feedIdol('rice')">🍚 白飯：<span id="rice">0</span></div>

</div>
<div class="tab-panel" id="tab_decor">
<div class="item-button" onclick="changeDecor()">🌼 裝飾品：<span id="bg_flower">❌</span></div>
<div class="item-button" onclick="toggleDog('haku')">🐶 Haku：<span id="dog_haku">❌</span></div>
<div class="item-button" onclick="toggleDog('mata')">🐶 Mata：<span id="dog_mata">❌</span></div>
<div class="item-button" onclick="toggleDog('moya')">🐶 Moya：<span id="dog_moya">❌</span></div>
</div>
<div class="tab-panel" id="tab_style"><div class="item-button" onclick="changeSkin()">👗 新造型：<span id="skin_v2">❌</span></div></div></div>
<!-- 回首頁按鈕 -->
<div class="buttons">
<button onclick="goHome()">回首頁</button>
</div>
<script>
  function goHome() {

    localStorage.setItem("fromBag", "true");
    window.location.href = "index.html";
  }
</script>
</div>
</div>
</div>

<script>


function updateDogVisualInBag() {
  const container = document.getElementById("dogDisplayContainer");
  container.innerHTML = "";

 const dogs = [
  { key: "haku", img: "haku_sit.PNG", name: "Haku" },
  { key: "mata", img: "mata_sit.PNG", name: "Mata" },
  { key: "moya", img: "moya_sit.png", name: "Moya" }
];


dogs.forEach(dog => {
  const show = localStorage.getItem("dog_display_" + dog.key) === "true";
  if (show) {
    const wrapper = document.createElement("div");
    wrapper.style.display = "flex";
    wrapper.style.flexDirection = "column";
    wrapper.style.alignItems = "center";

    const img = document.createElement("img");
    img.src = dog.img;
    img.style.width = "70px";
    img.style.height = "70px";
    img.style.imageRendering = "pixelated";

    const label = document.createElement("div");
    label.textContent = dog.name; // 例如 Haku
    label.style.fontSize = "12px";
    label.style.marginTop = "4px";
    label.style.textAlign = "center";

    wrapper.appendChild(img);
    wrapper.appendChild(label);
    container.appendChild(wrapper);
  }
});
}


function goHome() {
    localStorage.setItem("fromBag", "true");
    window.location.href = "index.html";
  }

function updateDecorDisplay() {
  const hasDecor = localStorage.getItem("item_bg_flower") === "true";
  const current = localStorage.getItem("current_decor");
  const span = document.getElementById("bg_flower");
  const button = span.closest(".item-button");

  if (hasDecor) {
    if (current === "bg_flower") {
      span.textContent = "✔ 已使用";
      button.classList.add("in-use");
    } else {
      span.textContent = "✔";
      button.classList.remove("in-use");
    }
  } else {
    span.textContent = "❌";
    button.classList.remove("in-use");
  }
}




    const expTable = {1: 89, 2: 106, 3: 520, 4: 1314, 5: 2000, 6: 2018};
    const idolName = localStorage.getItem("idolName") || "Shu";

    function expNeeded(level) {
      return expTable[level] || 99999;
    }

    function getExpInfo() {
      return {
        level: parseInt(localStorage.getItem("idol_level") || "1"),
        exp: parseInt(localStorage.getItem("idol_exp") || "0")
      };
    }

    function updateExpDisplay() {
      const { level, exp } = getExpInfo();
      const needed = expNeeded(level);
      document.getElementById("idolLevel").textContent = level;
      document.getElementById("idolExp").textContent = exp;
      document.getElementById("expToNext").textContent = needed;

      const container = document.getElementById("expBarContainer");
      container.innerHTML = "";
      const total = 10;
      const filled = Math.floor((exp / needed) * total);
      for (let i = 0; i < total; i++) {
        const block = document.createElement("div");
        block.style.backgroundColor = i < filled ? "#e0e0e0" : "#fff";
        container.appendChild(block);
      }
    }
	

function updateDogGroupDisplay(group) {
  const owned = localStorage.getItem("item_dog_" + group) === "true";
  const show = localStorage.getItem("dog_display_" + group) === "true";
  const span = document.getElementById("dog_" + group);
  const button = span.closest(".item-button");

  if (!owned) {
    span.textContent = "❌";
    button.classList.remove("in-use");
  } else {
    if (show) {
      span.textContent = "✔ 顯示中";
      button.classList.add("in-use");
    } else {
      span.textContent = "✔";
      button.classList.remove("in-use");
    }
  }
}

function updateCombinedDogImage() {
  const hasHaku = localStorage.getItem("item_dog_haku") === "true";
  const hasMata = localStorage.getItem("item_dog_mata") === "true";
  const idolImg = document.getElementById("idolStatic");

  if (hasHaku && hasMata) {
    idolImg.src = "haku_mata_sit.png";  // 你剛上傳的合圖
  }
}


function updateDogDisplay(dog) {
  const owned = localStorage.getItem("item_dog_" + dog) === "true";
  const show = localStorage.getItem("dog_display_" + dog) === "true";
  const span = document.getElementById("dog_" + dog);
  const button = span.closest(".item-button");

  if (!owned) {
    span.textContent = "❌";
    button.classList.remove("in-use");
  } else {
    if (show) {
      span.textContent = "✔ 顯示中";
      button.classList.add("in-use");
    } else {
      span.textContent = "✔";
      button.classList.remove("in-use");
    }
  }
}

function toggleDog(dog) {
  const owned = localStorage.getItem("item_dog_" + dog) === "true";
  if (!owned) {
    alert("你還沒有這隻狗狗唷！");
    return;
  }

  const current = localStorage.getItem("dog_display_" + dog) === "true";
  localStorage.setItem("dog_display_" + dog, (!current).toString());

  speak((!current ? `${dog} 來陪你走走囉～` : `${dog} 回去休息了唷～`));
  updateDogDisplay(dog);
  updateDogVisualInBag();

}



function updateSkinDisplay() {
  const hasSkin = localStorage.getItem("item_skin_v2") === "true";
  const current = localStorage.getItem("current_skin");
  const span = document.getElementById("skin_v2");
  const button = span.closest(".item-button");

  if (hasSkin) {
    if (current === "v2") {
      span.textContent = "✔ 已穿上";
      button.classList.add("in-use");
    } else {
      span.textContent = "✔";
      button.classList.remove("in-use");
    }
  } else {
    span.textContent = "❌";
    button.classList.remove("in-use");
  }
}



    function speak(text) {
  const bubble = document.getElementById("idolText");
  const name = idolName;

  // 顯示泡泡
  bubble.style.display = "flex";
  bubble.style.opacity = "1";
  bubble.innerText = "";  // ← 更保險的清空方式

  const fullText = name + "：" + text;
  let index = 0;

  const typingInterval = setInterval(() => {
    bubble.innerText += fullText[index];
    index++;
    if (index >= fullText.length) {
      clearInterval(typingInterval);
      setTimeout(() => {
        bubble.innerText = "";           // ← 確保內容清掉
        bubble.style.opacity = "0";      // 淡出
        // 不設 display，讓 :empty 自動生效
      }, 5000);
    }
  }, 50);
}

    function feedIdol(itemKey) {
      const nameMap = {
        "cake": "蛋糕", "vege": "蔬菜", "kimchi_rice": "泡菜炒飯", "rice": "白飯"
      };
      const expMap = {
        "cake": 16, "vege": 6, "kimchi_rice": 20, "rice": 6
      };
      const reactionMap = {
        "cake": "是起司的吧～我最喜歡了",
        "vege": "算你識相，女明星需要葉子",
        "kimchi_rice": "嗚哇...辣辣的但是好香，可是我在戒澱粉誒",
        "rice": "我在戒澱粉啦，真是..."
      };
      let raw = localStorage.getItem("item_" + itemKey);
      let count = parseInt(raw);
      if (isNaN(count) || count <= 0) {
        alert("你沒有這個食物唷！");
        return;
      }

      const confirmFeed = confirm(`要餵${idolName}吃${nameMap[itemKey]}嗎？`);
      if (confirmFeed) {
        count -= 1;
        localStorage.setItem("item_" + itemKey, count.toString());
        document.getElementById(itemKey).textContent = count;

        let level = parseInt(localStorage.getItem("idol_level") || "1");
        let exp = parseInt(localStorage.getItem("idol_exp") || "0");
        exp += expMap[itemKey] || 0;

        let leveledUp = false;
        while (exp >= expNeeded(level)) {
          exp -= expNeeded(level);
          level++;
          leveledUp = true;
        }
	if (level >= 5 && localStorage.getItem("item_skin_v2") !== "true") {
  	localStorage.setItem("item_skin_v2", "true");
 	 speak("我獲得了新造型耶～快去背包看看吧！💖", true);
	}


        localStorage.setItem("idol_exp", exp);
        localStorage.setItem("idol_level", level);
        updateExpDisplay();

        speak(reactionMap[itemKey] || `${idolName}好像吃得很開心 💗`);

        if (leveledUp) {
          alert(`🎉 ${idolName}升級了！目前等級 ${level}！`);
        }
      }
    }


function changeDecor() {
  const owned = localStorage.getItem("item_bg_flower") === "true";
  const current = localStorage.getItem("current_decor");

  if (!owned) {
    speak("你還沒有這個裝飾品唷！");
    return;
  }

  if (current === "bg_flower") {
    // 已套用 → 改為移除
    localStorage.removeItem("current_decor");
    speak("裝飾已經脫掉了喔（羞）");
  } else {
    // 未套用 → 直接套用
    localStorage.setItem("current_decor", "bg_flower");
    speak("我下次會穿漂亮的唷～");
  }

  updateDecorDisplay();
}


    
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(el => {
    el.classList.toggle('active', el.dataset.tab === tab);
  });
  document.querySelectorAll('.tab-panel').forEach(el => {
    el.classList.toggle('active', el.id === 'tab_' + tab);
  });
}

window.onload = () => {

updateDogVisualInBag();

updateDogDisplay("haku");
updateDogDisplay("mata");
updateDogDisplay("moya");

updateCombinedDogImage();
document.getElementById("idolNameText").textContent = idolName;



switchTab('food'); 


const skin = localStorage.getItem("current_skin");
if (skin === "v2") {
  const idolImg = document.getElementById("idolStatic");
  idolImg.src = "sit_v2.png";
}

updateSkinDisplay();

  // 更新裝飾品狀態顯示（✔ / ✔ 已使用 / ❌）
  updateDecorDisplay();

  // 顯示目前的食物數量
  ["cake", "vege", "kimchi_rice", "rice"].forEach(item => {
    document.getElementById(item).textContent =
      localStorage.getItem("item_" + item) || "0";
  });

  // 初始化經驗值條與等級文字
  updateExpDisplay();
};

  </script>
</body>
</html>