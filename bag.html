<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">

<link href="https://cdn.jsdelivr.net/gh/Unifoundry/Unifont@14.0.01/font-builds/unifont.min.css" rel="stylesheet"/>
<meta charset="utf-8"/>
<title>èƒŒåŒ…</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<link href="style.css" rel="stylesheet"/>
<style>
    body {
      
      font-family: monospace;
      font-size: 14px;
      letter-spacing: 0.5px;
   }

    .card h1 {
      text-align: center;
      font-family: 'VT323', monospace;
      font-size: 37px;
      margin-top: 20;
      margin-bottom: 10px;
   }

    .item-button {
      display: inline-block;
      background-color: #fff;
      border: 2px solid #000;
      border-radius: 12px;
      padding: 10px 16px;
      cursor: pointer;
      font-size: 16px;
      transition: background-color 0.2s, transform 0.1s;
    }

    .item-button:hover {
      background-color: #f0f0f0;
      transform: scale(1.02);
    }

    .card-wrapper {
      display: flex;
      justify-content: center;
      gap: 40px;
    }

    .card {
      background: #fff;
      border: 4px solid #000;
      border-radius: 24px;
      box-shadow: 8px 8px 0 #000;
      padding: 32px;
      width: 280px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    #idolStatic {
      width: 128px;
      height: 128px;
      image-rendering: pixelated;
      align-self: center;
    }

    

    .pixel-bar {
     display: flex;
     gap: 2px;
     justify-content: center;
     margin: 6px auto 0 auto; 
     width: fit-content;
   }


 .idolTextWrapper {
  display: flex;
  justify-content: center;
  margin-top: 16px;  /* âœ… å¢åŠ èˆ‡åœ–ç‰‡çš„è·é›¢ */
  margin-bottom: 6px;
}

#idolText {
  font-family: 'VT323', monospace;
  font-size: 12px;
  color: #000;
  background-color: #fff;
  padding: 10px 16px;
  border: 4px solid #000;
  border-radius: 8px;
  box-shadow: 4px 4px 0 #000;
  text-align: center;
  line-height: 1.3;
  transition: opacity 0.3s ease;

  min-height: 48px;
  max-height: 48px;
  overflow: hidden;
  display: flex;
  align-items: center;
  justify-content: center;
}

#idolText:empty {
  display: none;
}


    button {
      font-size: 14px;
      font-family: sans-serif;
      padding: 10px 20px;
      cursor: pointer;
    }
    .idol-info {
      text-align: center;
    }

  </style>
</head>
<body>
<div class="main-wrapper">
<div class="card-wrapper">

<!-- å·¦é‚Šå¡ç‰‡ï¼šå¶åƒå€ -->
<div class="card" style="position: relative;">
  <div class="card-inner" style="margin-top: 24px;">
    <!-- å¶åƒåœ–ç‰‡ -->
    <img id="idolStatic" src="sit.png"
         style="width: 120px; height: 120px; image-rendering: pixelated; display: block; margin: 0 auto 20px;" />
	<div id="idolNameText"
     style="text-align: center;
            font-family: 'VT323', monospace;
            font-size: 37px;
            margin-bottom: 12px;
            padding-bottom: 4px;
            border-bottom: 2px solid #000;
            width: fit-content;
            margin-left: auto;
            margin-right: auto;">
</div>


    <!-- ç­‰ç´šèˆ‡ç¶“é©—æ¢ -->
    <div class="idol-info">
      ç­‰ç´šï¼š<span id="idolLevel">1</span><br/>
      ç¶“é©—å€¼ï¼š<span id="idolExp">0</span> / <span id="expToNext">100</span>
      <div class="pixel-bar" id="expBarContainer"></div>
    </div>

    <!-- èˆ’è¯èªªè©± -->
    <div class="idolTextWrapper">
      <div id="idolText"></div>
    </div>
  </div>

  <!-- ç‹—ç‹—åœ–ç‰‡èˆ‡åå­—ï¼Œå›ºå®šåœ¨å¡ç‰‡åº•éƒ¨ -->
  <div id="dogDisplayContainer"
       style="position: absolute; bottom: 52px; left: 0; width: 100%;
              display: flex; justify-content: center; gap: 8px;">
  </div>
</div>



<!-- å³é‚Šå¡ç‰‡ï¼šèƒŒåŒ…å€ -->
<div class="card">
<h1>backpack</h1>
<!-- åˆ†é æ¨™ç±¤ -->
<div class="tabs">
<div class="tab active" data-tab="food" onclick="switchTab('food')">ğŸ½ï¸ é£Ÿç‰©</div>
<div class="tab" data-tab="decor" onclick="switchTab('decor')">ğŸ–¼ï¸ è£é£¾</div>
<div class="tab" data-tab="style" onclick="switchTab('style')">ğŸ‘— é€ å‹</div></div>
<!-- å›ºå®šé«˜åº¦çš„å…§å®¹å®¹å™¨ -->
<div class="tab-content-container">
<div class="tab-panel active" id="tab_food">
<div class="item-button" onclick="feedIdol('cake')">ğŸ° è›‹ç³•ï¼š<span id="cake">0</span></div>
<div class="item-button" onclick="feedIdol('vege')">ğŸ¥¬ è”¬èœï¼š<span id="vege">0</span></div>
<div class="item-button" onclick="feedIdol('kimchi_rice')">ğŸ› æ³¡èœç‚’é£¯ï¼š<span id="kimchi_rice">0</span></div>
<div class="item-button" onclick="feedIdol('rice')">ğŸš ç™½é£¯ï¼š<span id="rice">0</span></div>

</div>
<div class="tab-panel" id="tab_decor">
<div class="item-button" onclick="changeDecor()">ğŸŒ¼ è£é£¾å“ï¼š<span id="bg_flower">âŒ</span></div>
<div class="item-button" onclick="toggleDog('haku')">ğŸ¶ Hakuï¼š<span id="dog_haku">âŒ</span></div>
<div class="item-button" onclick="toggleDog('mata')">ğŸ¶ Mataï¼š<span id="dog_mata">âŒ</span></div>
<div class="item-button" onclick="toggleDog('moya')">ğŸ¶ Moyaï¼š<span id="dog_moya">âŒ</span></div>
</div>
<div class="tab-panel" id="tab_style"><div class="item-button" onclick="changeSkin()">ğŸ‘— æ–°é€ å‹ï¼š<span id="skin_v2">âŒ</span></div></div></div>
<!-- å›é¦–é æŒ‰éˆ• -->
<div class="buttons">
<button onclick="goHome()">å›é¦–é </button>
</div>
<script>
  function goHome() {

    localStorage.setItem("fromBag", "true");
    window.location.href = "index.html";
  }
</script>
</div>
</div>
</div>

<script>


function updateDogVisualInBag() {
  const container = document.getElementById("dogDisplayContainer");
  container.innerHTML = "";

 const dogs = [
  { key: "haku", img: "haku_sit.PNG", name: "Haku" },
  { key: "mata", img: "mata_sit.PNG", name: "Mata" },
  { key: "moya", img: "moya_sit.png", name: "Moya" }
];


dogs.forEach(dog => {
  const show = localStorage.getItem("dog_display_" + dog.key) === "true";
  if (show) {
    const wrapper = document.createElement("div");
    wrapper.style.display = "flex";
    wrapper.style.flexDirection = "column";
    wrapper.style.alignItems = "center";

    const img = document.createElement("img");
    img.src = dog.img;
    img.style.width = "70px";
    img.style.height = "70px";
    img.style.imageRendering = "pixelated";

    const label = document.createElement("div");
    label.textContent = dog.name; // ä¾‹å¦‚ Haku
    label.style.fontSize = "12px";
    label.style.marginTop = "4px";
    label.style.textAlign = "center";

    wrapper.appendChild(img);
    wrapper.appendChild(label);
    container.appendChild(wrapper);
  }
});
}


function goHome() {
    localStorage.setItem("fromBag", "true");
    window.location.href = "index.html";
  }

function updateDecorDisplay() {
  const hasDecor = localStorage.getItem("item_bg_flower") === "true";
  const current = localStorage.getItem("current_decor");
  const span = document.getElementById("bg_flower");
  const button = span.closest(".item-button");

  if (hasDecor) {
    if (current === "bg_flower") {
      span.textContent = "âœ” å·²ä½¿ç”¨";
      button.classList.add("in-use");
    } else {
      span.textContent = "âœ”";
      button.classList.remove("in-use");
    }
  } else {
    span.textContent = "âŒ";
    button.classList.remove("in-use");
  }
}




    const expTable = {1: 89, 2: 106, 3: 520, 4: 1314, 5: 2000, 6: 2018};
    const idolName = localStorage.getItem("idolName") || "Shu";

    function expNeeded(level) {
      return expTable[level] || 99999;
    }

    function getExpInfo() {
      return {
        level: parseInt(localStorage.getItem("idol_level") || "1"),
        exp: parseInt(localStorage.getItem("idol_exp") || "0")
      };
    }

    function updateExpDisplay() {
      const { level, exp } = getExpInfo();
      const needed = expNeeded(level);
      document.getElementById("idolLevel").textContent = level;
      document.getElementById("idolExp").textContent = exp;
      document.getElementById("expToNext").textContent = needed;

      const container = document.getElementById("expBarContainer");
      container.innerHTML = "";
      const total = 10;
      const filled = Math.floor((exp / needed) * total);
      for (let i = 0; i < total; i++) {
        const block = document.createElement("div");
        block.style.backgroundColor = i < filled ? "#e0e0e0" : "#fff";
        container.appendChild(block);
      }
    }
	

function updateDogGroupDisplay(group) {
  const owned = localStorage.getItem("item_dog_" + group) === "true";
  const show = localStorage.getItem("dog_display_" + group) === "true";
  const span = document.getElementById("dog_" + group);
  const button = span.closest(".item-button");

  if (!owned) {
    span.textContent = "âŒ";
    button.classList.remove("in-use");
  } else {
    if (show) {
      span.textContent = "âœ” é¡¯ç¤ºä¸­";
      button.classList.add("in-use");
    } else {
      span.textContent = "âœ”";
      button.classList.remove("in-use");
    }
  }
}

function updateCombinedDogImage() {
  const hasHaku = localStorage.getItem("item_dog_haku") === "true";
  const hasMata = localStorage.getItem("item_dog_mata") === "true";
  const idolImg = document.getElementById("idolStatic");

  if (hasHaku && hasMata) {
    idolImg.src = "haku_mata_sit.png";  // ä½ å‰›ä¸Šå‚³çš„åˆåœ–
  }
}


function updateDogDisplay(dog) {
  const owned = localStorage.getItem("item_dog_" + dog) === "true";
  const show = localStorage.getItem("dog_display_" + dog) === "true";
  const span = document.getElementById("dog_" + dog);
  const button = span.closest(".item-button");

  if (!owned) {
    span.textContent = "âŒ";
    button.classList.remove("in-use");
  } else {
    if (show) {
      span.textContent = "âœ” é¡¯ç¤ºä¸­";
      button.classList.add("in-use");
    } else {
      span.textContent = "âœ”";
      button.classList.remove("in-use");
    }
  }
}

function toggleDog(dog) {
  const owned = localStorage.getItem("item_dog_" + dog) === "true";
  if (!owned) {
    alert("ä½ é‚„æ²’æœ‰é€™éš»ç‹—ç‹—å”·ï¼");
    return;
  }

  const current = localStorage.getItem("dog_display_" + dog) === "true";
  localStorage.setItem("dog_display_" + dog, (!current).toString());

  speak((!current ? `${dog} ä¾†é™ªä½ èµ°èµ°å›‰ï½` : `${dog} å›å»ä¼‘æ¯äº†å”·ï½`));
  updateDogDisplay(dog);
  updateDogVisualInBag();

}



function updateSkinDisplay() {
  const hasSkin = localStorage.getItem("item_skin_v2") === "true";
  const current = localStorage.getItem("current_skin");
  const span = document.getElementById("skin_v2");
  const button = span.closest(".item-button");

  if (hasSkin) {
    if (current === "v2") {
      span.textContent = "âœ” å·²ç©¿ä¸Š";
      button.classList.add("in-use");
    } else {
      span.textContent = "âœ”";
      button.classList.remove("in-use");
    }
  } else {
    span.textContent = "âŒ";
    button.classList.remove("in-use");
  }
}



    function speak(text) {
  const bubble = document.getElementById("idolText");
  const name = idolName;

  // é¡¯ç¤ºæ³¡æ³¡
  bubble.style.display = "flex";
  bubble.style.opacity = "1";
  bubble.innerText = "";  // â† æ›´ä¿éšªçš„æ¸…ç©ºæ–¹å¼

  const fullText = name + "ï¼š" + text;
  let index = 0;

  const typingInterval = setInterval(() => {
    bubble.innerText += fullText[index];
    index++;
    if (index >= fullText.length) {
      clearInterval(typingInterval);
      setTimeout(() => {
        bubble.innerText = "";           // â† ç¢ºä¿å…§å®¹æ¸…æ‰
        bubble.style.opacity = "0";      // æ·¡å‡º
        // ä¸è¨­ displayï¼Œè®“ :empty è‡ªå‹•ç”Ÿæ•ˆ
      }, 5000);
    }
  }, 50);
}

    function feedIdol(itemKey) {
      const nameMap = {
        "cake": "è›‹ç³•", "vege": "è”¬èœ", "kimchi_rice": "æ³¡èœç‚’é£¯", "rice": "ç™½é£¯"
      };
      const expMap = {
        "cake": 16, "vege": 6, "kimchi_rice": 20, "rice": 6
      };
      const reactionMap = {
        "cake": "æ˜¯èµ·å¸çš„å§ï½æˆ‘æœ€å–œæ­¡äº†",
        "vege": "ç®—ä½ è­˜ç›¸ï¼Œå¥³æ˜æ˜Ÿéœ€è¦è‘‰å­",
        "kimchi_rice": "å—šå“‡...è¾£è¾£çš„ä½†æ˜¯å¥½é¦™ï¼Œå¯æ˜¯æˆ‘åœ¨æˆ’æ¾±ç²‰èª’",
        "rice": "æˆ‘åœ¨æˆ’æ¾±ç²‰å•¦ï¼ŒçœŸæ˜¯..."
      };
      let raw = localStorage.getItem("item_" + itemKey);
      let count = parseInt(raw);
      if (isNaN(count) || count <= 0) {
        alert("ä½ æ²’æœ‰é€™å€‹é£Ÿç‰©å”·ï¼");
        return;
      }

      const confirmFeed = confirm(`è¦é¤µ${idolName}åƒ${nameMap[itemKey]}å—ï¼Ÿ`);
      if (confirmFeed) {
        count -= 1;
        localStorage.setItem("item_" + itemKey, count.toString());
        document.getElementById(itemKey).textContent = count;

        let level = parseInt(localStorage.getItem("idol_level") || "1");
        let exp = parseInt(localStorage.getItem("idol_exp") || "0");
        exp += expMap[itemKey] || 0;

        let leveledUp = false;
        while (exp >= expNeeded(level)) {
          exp -= expNeeded(level);
          level++;
          leveledUp = true;
        }
	if (level >= 5 && localStorage.getItem("item_skin_v2") !== "true") {
  	localStorage.setItem("item_skin_v2", "true");
 	 speak("æˆ‘ç²å¾—äº†æ–°é€ å‹è€¶ï½å¿«å»èƒŒåŒ…çœ‹çœ‹å§ï¼ğŸ’–", true);
	}


        localStorage.setItem("idol_exp", exp);
        localStorage.setItem("idol_level", level);
        updateExpDisplay();

        speak(reactionMap[itemKey] || `${idolName}å¥½åƒåƒå¾—å¾ˆé–‹å¿ƒ ğŸ’—`);

        if (leveledUp) {
          alert(`ğŸ‰ ${idolName}å‡ç´šäº†ï¼ç›®å‰ç­‰ç´š ${level}ï¼`);
        }
      }
    }


function changeDecor() {
  const owned = localStorage.getItem("item_bg_flower") === "true";
  const current = localStorage.getItem("current_decor");

  if (!owned) {
    speak("ä½ é‚„æ²’æœ‰é€™å€‹è£é£¾å“å”·ï¼");
    return;
  }

  if (current === "bg_flower") {
    // å·²å¥—ç”¨ â†’ æ”¹ç‚ºç§»é™¤
    localStorage.removeItem("current_decor");
    speak("è£é£¾å·²ç¶“è„«æ‰äº†å–”ï¼ˆç¾ï¼‰");
  } else {
    // æœªå¥—ç”¨ â†’ ç›´æ¥å¥—ç”¨
    localStorage.setItem("current_decor", "bg_flower");
    speak("æˆ‘ä¸‹æ¬¡æœƒç©¿æ¼‚äº®çš„å”·ï½");
  }

  updateDecorDisplay();
}


    
function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(el => {
    el.classList.toggle('active', el.dataset.tab === tab);
  });
  document.querySelectorAll('.tab-panel').forEach(el => {
    el.classList.toggle('active', el.id === 'tab_' + tab);
  });
}

window.onload = () => {

updateDogVisualInBag();

updateDogDisplay("haku");
updateDogDisplay("mata");
updateDogDisplay("moya");

updateCombinedDogImage();
document.getElementById("idolNameText").textContent = idolName;



switchTab('food'); 


const skin = localStorage.getItem("current_skin");
if (skin === "v2") {
  const idolImg = document.getElementById("idolStatic");
  idolImg.src = "sit_v2.png";
}

updateSkinDisplay();

  // æ›´æ–°è£é£¾å“ç‹€æ…‹é¡¯ç¤ºï¼ˆâœ” / âœ” å·²ä½¿ç”¨ / âŒï¼‰
  updateDecorDisplay();

  // é¡¯ç¤ºç›®å‰çš„é£Ÿç‰©æ•¸é‡
  ["cake", "vege", "kimchi_rice", "rice"].forEach(item => {
    document.getElementById(item).textContent =
      localStorage.getItem("item_" + item) || "0";
  });

  // åˆå§‹åŒ–ç¶“é©—å€¼æ¢èˆ‡ç­‰ç´šæ–‡å­—
  updateExpDisplay();
};

  </script>
</body>
</html>